<?xml version="1.0"?>

<project name="BehaviorTracking" default="all-dist"
		 xmlns:ivy="antlib:org.apache.ivy.ant">

	<import file="scripts/build-master.xml"/>
	
	<target name="all-dist" depends="all,package-utils,doc"/>
	
	<target name="package-utils" description="package command line utilities">
	
	    <ivy:resolve file="utils/ivy.xml"/>
		<property name="utils.dist" value="${target.dir}/utils"/>
		
		<!-- create separate distributions for java 5 and 6 -->
		<for list="5,6" param="current.version">
			<sequential>
				<var name="utils.dist" value="${target.dir}/java@{current.version}/utils"/>
			    <mkdir dir="${utils.dist}"/>
				
			    <ivy:retrieve useOrigin="true"
			                  pattern="${utils.dist}/lib/[artifact]-[revision].[ext]"
							  conf="1.@{current.version}"/>
			
				<copy todir="${utils.dist}">
					<fileset dir="db" includes="etl/**"/>
		            <fileset dir="${build.root}/utils/dist/jars"
		                     includes="**/*.jar" excludes="**/*test*"/>
					<fileset dir="utils/bin" includes="**/**"/>
				</copy>
				
				<zip file="${target.dir}/bt-utils-java@{current.version}.zip">
					<zipfileset prefix="BehaviorTracking" dir="${utils.dist}" includes="**/*"/>
				</zip>
			</sequential>
		</for>
	
	</target>
	
</project>