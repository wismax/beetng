<?xml version="1.0"?>

<project name='BehaviorTracking' basedir='.' default='cruise'>
  <description>
	Delegating build script for Cruise Control to run the local build
	of BehaviorTracking
  </description>

  <!-- Environment variables can be found by prefixing with env. -->
  <property environment='env'/>

  <property name="module.status" value="milestone" />

  <target name='cruise' depends='update,build,publish_ivy,registerBuild' />

  <target name='update'>
    <echo message="build #${env.CC_BUILD_REVISION} - ${env.CC_BUILD_ARTIFACTS}" />
    <exec command="svn" output="${user.dir}/version.xml">
      <arg value="info" />
      <arg value="--xml" />
    </exec>
    <propertyfile  file="${user.dir}/module.properties">
      <entry key="module.status" value="${module.status}" />
      <entry key="build.number" value="${env.CC_BUILD_REVISION}" />
    </propertyfile>
  </target>

  <target name='build'>
        <property name="local.properties" value="/home/BldAcct/library.properties"/>
  	<ant inheritAll='false' target='all' />
  	<ant inheritAll='false' target='doc' />
  </target>

  <target name='cruisedeploy'>
	<ant inheritAll='false' target='deploy'/>
  </target>

  <target name="publish_artifacts">
	<copy todir="${env.CC_BUILD_ARTIFACTS}">
	    <fileset dir="build/target" includes="*.jar *.md5" />
	</copy>
  </target>

  <target name="tarball">
	<exec executable="./package.rb"/>
  </target>

  <target name="publish_ivy">
    <ant inheritAll='false' antfile='/home/BldAcct/buildScripts/publish-ivy.xml'>
      <property name="publish.overwrite" value="true" />
    </ant>
  </target>

  <target name="registerBuild">
    <echo message="Register the build with BT" />
    <exec executable='/home/BldAcct/registerBuild.rb'>
      <arg value="BehaviorTracking" />
    </exec>
  </target>
</project>
